(function(n){function r(r){function w(t){l||(l=!0,a=t.getCanvas(),h=n(a).parent(),u=t.getOptions(),t.setData(b(t.getData())))}function b(t){for(var i,f=0,e=0,o=0,s=u.series.pie.combine.color,h=[],r=0;r<t.length;++r)i=t[r].data,n.isArray(i)&&i.length==1&&(i=i[0]),n.isArray(i)?i[1]=!isNaN(parseFloat(i[1]))&&isFinite(i[1])?+i[1]:0:i=!isNaN(parseFloat(i))&&isFinite(i)?[1,+i]:[1,0],t[r].data=[i];for(r=0;r<t.length;++r)f+=t[r].data[0][1];for(r=0;r<t.length;++r)i=t[r].data[0][1],i/f<=u.series.pie.combine.threshold&&(e+=i,o++,s||(s=t[r].color));for(r=0;r<t.length;++r)i=t[r].data[0][1],(o<2||i/f>u.series.pie.combine.threshold)&&h.push(n.extend(t[r],{data:[[1,i]],color:t[r].color,label:t[r].label,angle:i*Math.PI*2/f,percent:i/(f/100)}));return o>1&&h.push({data:[[1,e]],color:s,label:u.series.pie.combine.label,angle:e*Math.PI*2/f,percent:e/(f/100)}),h}function k(r,s){function k(){f.clearRect(0,0,y,p);h.children().filter(".pieLabel, .pieLabelBackground").remove()}function d(){var i=u.series.pie.shadow.left,r=u.series.pie.shadow.top,s=10,h=u.series.pie.shadow.alpha,n=u.series.pie.radius>1?u.series.pie.radius:o*u.series.pie.radius,t;if(!(n>=y/2-i)&&!(n*u.series.pie.tilt>=p/2-r)&&!(n<=s)){for(f.save(),f.translate(i,r),f.globalAlpha=h,f.fillStyle="#000",f.translate(e,c),f.scale(1,u.series.pie.tilt),t=1;t<=s;t++)f.beginPath(),f.arc(0,0,n,0,Math.PI*2,!1),f.fill(),n-=t;f.restore()}}function g(){function l(n,t,r){n<=0||isNaN(n)||(r?f.fillStyle=t:(f.strokeStyle=t,f.lineJoin="round"),f.beginPath(),Math.abs(n-Math.PI*2)>1e-9&&f.moveTo(0,0),f.arc(0,0,s,i,i+n/2,!1),f.arc(0,0,s,i+n/2,i+n,!1),f.closePath(),i+=n,r?f.fill():f.stroke())}function w(){function s(t,i,r){var w,s,b,v,nt;if(t.data[0][1]==0)return!0;w=u.legend.labelFormatter;b=u.series.pie.label.formatter;s=w?w(t.label,t):t.label;b&&(s=b(s,t));var k=(i+t.angle+i)/2,d=e+Math.round(Math.cos(k)*f),g=c+Math.round(Math.sin(k)*f)*u.series.pie.tilt,tt="<span class='pieLabel' id='pieLabel"+r+"' style='position:absolute;top:"+g+"px;left:"+d+"px;'>"+s+"<\/span>";h.append(tt);var o=h.children("#pieLabel"+r),l=g-o.height()/2,a=d-o.width()/2;return(o.css("top",l),o.css("left",a),0-l>0||0-a>0||p-(l+o.height())<0||y-(a+o.width())<0)?!1:(u.series.pie.label.background.opacity!=0&&(v=u.series.pie.label.background.color,v==null&&(v=t.color),nt="top:"+l+"px;left:"+a+"px;",n("<div class='pieLabelBackground' style='position:absolute;width:"+o.width()+"px;height:"+o.height()+"px;"+nt+"background-color:"+v+";'><\/div>").css("opacity",u.series.pie.label.background.opacity).insertBefore(o)),!0)}for(var i=r,f=u.series.pie.label.radius>1?u.series.pie.label.radius:o*u.series.pie.label.radius,t=0;t<a.length;++t){if(a[t].percent>=u.series.pie.label.threshold*100&&!s(a[t],i,t))return!1;i+=a[t].angle}return!0}var r=Math.PI*u.series.pie.startAngle,s=u.series.pie.radius>1?u.series.pie.radius:o*u.series.pie.radius,i,t;for(f.save(),f.translate(e,c),f.scale(1,u.series.pie.tilt),f.save(),i=r,t=0;t<a.length;++t)a[t].startAngle=i,l(a[t].angle,a[t].color,!0);if(f.restore(),u.series.pie.stroke.width>0){for(f.save(),f.lineWidth=u.series.pie.stroke.width,i=r,t=0;t<a.length;++t)l(a[t].angle,u.series.pie.stroke.color,!1);f.restore()}return v(f),f.restore(),u.series.pie.label.show?w():!0}var a,w;if(h){var y=r.getPlaceholder().width(),p=r.getPlaceholder().height(),b=h.children().filter(".legend").children().width()||0;f=s;l=!1;o=Math.min(y,p/u.series.pie.tilt)/2;c=p/2+u.series.pie.offset.top;e=y/2;u.series.pie.offset.left=="auto"?(u.legend.position.match("w")?e+=b/2:e-=b/2,e<o?e=o:e>y-o&&(e=y-o)):e+=u.series.pie.offset.left;a=r.getData();w=0;do w>0&&(o*=i),w+=1,k(),u.series.pie.tilt<=.8&&d();while(!g()&&w<t);w>=t&&(k(),h.prepend("<div class='error'>Could not draw pie with labels contained inside canvas<\/div>"));r.setSeries&&r.insertLegend&&(r.setSeries(a),r.insertLegend())}}function v(n){if(u.series.pie.innerRadius>0){n.save();var t=u.series.pie.innerRadius>1?u.series.pie.innerRadius:o*u.series.pie.innerRadius;n.globalCompositeOperation="destination-out";n.beginPath();n.fillStyle=u.series.pie.stroke.color;n.arc(0,0,t,0,Math.PI*2,!1);n.fill();n.closePath();n.restore();n.save();n.beginPath();n.strokeStyle=u.series.pie.stroke.color;n.arc(0,0,t,0,Math.PI*2,!1);n.stroke();n.closePath();n.restore()}}function d(n,t){for(var u=!1,i=-1,f=n.length,r=f-1;++i<f;r=i)(n[i][1]<=t[1]&&t[1]<n[r][1]||n[r][1]<=t[1]&&t[1]<n[i][1])&&t[0]<(n[r][0]-n[i][0])*(t[1]-n[i][1])/(n[r][1]-n[i][1])+n[i][0]&&(u=!u);return u}function g(n,t){for(var i,l=r.getData(),h=r.getOptions(),u=h.series.pie.radius>1?h.series.pie.radius:o*h.series.pie.radius,a,v,s=0;s<l.length;++s)if(i=l[s],i.pie.show){if(f.save(),f.beginPath(),f.moveTo(0,0),f.arc(0,0,u,i.startAngle,i.startAngle+i.angle/2,!1),f.arc(0,0,u,i.startAngle+i.angle/2,i.startAngle+i.angle,!1),f.closePath(),a=n-e,v=t-c,f.isPointInPath){if(f.isPointInPath(n-e,t-c))return f.restore(),{datapoint:[i.percent,i.data],dataIndex:0,series:i,seriesIndex:s}}else{var y=u*Math.cos(i.startAngle),p=u*Math.sin(i.startAngle),w=u*Math.cos(i.startAngle+i.angle/4),b=u*Math.sin(i.startAngle+i.angle/4),k=u*Math.cos(i.startAngle+i.angle/2),g=u*Math.sin(i.startAngle+i.angle/2),nt=u*Math.cos(i.startAngle+i.angle/1.5),tt=u*Math.sin(i.startAngle+i.angle/1.5),it=u*Math.cos(i.startAngle+i.angle),rt=u*Math.sin(i.startAngle+i.angle),ut=[[0,0],[y,p],[w,b],[k,g],[nt,tt],[it,rt]],ft=[a,v];if(d(ut,ft))return f.restore(),{datapoint:[i.percent,i.data],dataIndex:0,series:i,seriesIndex:s}}f.restore()}return null}function nt(n){y("plothover",n)}function tt(n){y("plotclick",n)}function y(n,t){var o=r.offset(),l=parseInt(t.pageX-o.left),a=parseInt(t.pageY-o.top),i=g(l,a),f,e,c;if(u.grid.autoHighlight)for(f=0;f<s.length;++f)e=s[f],e.auto!=n||i&&e.series==i.series||rt(e.series);i&&it(i.series,n);c={pageX:t.pageX,pageY:t.pageY};h.trigger(n,[c,i])}function it(n,t){var i=p(n);i==-1?(s.push({series:n,auto:t}),r.triggerRedrawOverlay()):t||(s[i].auto=!1)}function rt(n){n==null&&(s=[],r.triggerRedrawOverlay());var t=p(n);t!=-1&&(s.splice(t,1),r.triggerRedrawOverlay())}function p(n){for(var i,t=0;t<s.length;++t)if(i=s[t],i.series==n)return t;return-1}function ut(n,t){function f(n){n.angle<=0||isNaN(n.angle)||(t.fillStyle="rgba(255, 255, 255, "+i.series.pie.highlight.opacity+")",t.beginPath(),Math.abs(n.angle-Math.PI*2)>1e-9&&t.moveTo(0,0),t.arc(0,0,u,n.startAngle,n.startAngle+n.angle/2,!1),t.arc(0,0,u,n.startAngle+n.angle/2,n.startAngle+n.angle,!1),t.closePath(),t.fill())}var i=n.getOptions(),u=i.series.pie.radius>1?i.series.pie.radius:o*i.series.pie.radius,r;for(t.save(),t.translate(e,c),t.scale(1,i.series.pie.tilt),r=0;r<s.length;++r)f(s[r].series);v(t);t.restore()}var a=null,h=null,u=null,o=null,e=null,c=null,l=!1,f=null,s=[];r.hooks.processOptions.push(function(n,t){t.series.pie.show&&(t.grid.show=!1,t.series.pie.label.show=="auto"&&(t.series.pie.label.show=t.legend.show?!1:!0),t.series.pie.radius=="auto"&&(t.series.pie.radius=t.series.pie.label.show?3/4:1),t.series.pie.tilt>1?t.series.pie.tilt=1:t.series.pie.tilt<0&&(t.series.pie.tilt=0))});r.hooks.bindEvents.push(function(n,t){var i=n.getOptions();i.series.pie.show&&(i.grid.hoverable&&t.unbind("mousemove").mousemove(nt),i.grid.clickable&&t.unbind("click").click(tt))});r.hooks.processDatapoints.push(function(n,t,i,r){var u=n.getOptions();u.series.pie.show&&w(n,t,i,r)});r.hooks.drawOverlay.push(function(n,t){var i=n.getOptions();i.series.pie.show&&ut(n,t)});r.hooks.draw.push(function(n,t){var i=n.getOptions();i.series.pie.show&&k(n,t)})}var t=10,i=.95,u={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:3/2,tilt:1,shadow:{left:5,top:15,alpha:.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(n,t){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+t.color+";'>"+n+"<br/>"+Math.round(t.percent)+"%<\/div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};n.plot.plugins.push({init:r,options:u,name:"pie",version:"1.1"})})(jQuery);
//# sourceMappingURL=jquery.flot.pie.min.js.map
